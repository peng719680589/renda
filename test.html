<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>capture screen</title>
</head>
<body>
<input type="file" id="input" accept="video/*" onchange="handleFiles(this.files);" multiple>
<div class="addVideo"><video src="" id="video0" controls="controls" preload="none" style="display: none;"></video></div>
<div id="output"></div>
<input id="btn2" type="button" value="shangchuan">

<script src="assets/js/jquery.min.js"></script>
<script>

    var inputElement = document.getElementById("input");
    inputElement.addEventListener("change",handleFiles,false);
    var video_lsit = [];
    function handleFiles() {
        var fileList = this.files;
        for (var i = 0;i<fileList.length;i++){

            console.log(fileList[i])
        }
        return fileList
    }
    $("#input").change(function(){
        $("#output img").each(function(){
            $(this).remove();
        });
        var asd= "";
        var aaa =handleFiles();
        for (var h = 0;h < aaa.length ;h++){

            var objUrl = getObjectURL(this.files[h]);
            console.log(objUrl);
            asd +="<video src=\""+objUrl+"\" id=\"video0\" controls=\"controls\" preload=\"none\" style=\"display: none;\"></video>"

            $("#video0").attr("src", objUrl) ;


        }
        // $(objUrl).each(function () {
        //     $("#video0").attr("src", objUrl) ;
        // });
        // if (objUrl) {
        //     $("#video0").attr("src", objUrl) ;
        // }
        // var objUrl = getObjectURL(this.files[0]);
        console.log("objUrl = "+objUrl) ;

    }) ;
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }

    var video, output;
    var scale = 0.2;
    var initialize = function() {
        output = document.getElementById("output");
        video = document.getElementById("video0");
        video.addEventListener('loadeddata',captureImage);
    };

    var captureImage = function() {
        var canvas = document.createElement("canvas");
        canvas.width = video.videoWidth * scale;
        canvas.height = video.videoHeight * scale;
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        var img = document.createElement("img");
        img.src = canvas.toDataURL("image/png");
        output.appendChild(img);
    };

    initialize();

    $("#btn2").click(function () {
// alert(22)
        var formData = new FormData();
        var pic = document.getElementById("video0").files;

        for(var n=0;n< pic.length ;n++){
            formData.append(""+n+"",pic[n]);
        }
        $.ajax({
            url : "http://192.168.0.117:8081/duty/record/file",
            type: 'POST',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success : function(data) {
                pic_list = data.obj;
                console.log(data);
            },
            error : function(data) {
                console.log(data);
            }
        });
    });

</script>
</body>
</html>